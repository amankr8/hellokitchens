<div
  class="fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-4 bg-black/60 backdrop-blur-sm"
>
  <div
    class="bg-white w-full max-w-md rounded-[2.5rem] p-8 shadow-2xl relative animate-in slide-in-from-bottom duration-300"
  >
    <button
      (click)="close.emit()"
      class="absolute top-6 right-6 w-10 h-10 flex items-center justify-center rounded-full bg-gray-50 text-gray-400 hover:bg-orange-50 hover:text-orange-600 transition-all active:scale-90"
    >
      <fa-icon [icon]="icons.close" class="text-lg"></fa-icon>
    </button>

    <div
      *ngIf="error()"
      class="mb-6 p-4 bg-red-50 border border-red-100 rounded-2xl flex items-center gap-3 text-red-600 animate-pulse"
    >
      <fa-icon [icon]="icons.error"></fa-icon>
      <span class="text-xs font-bold">{{ error() }}</span>
    </div>

    <div *ngIf="step() === 'phone'" class="space-y-6">
      <div class="text-center pt-4">
        <h3 class="text-2xl font-black text-gray-900">Enter Phone Number</h3>
        <p class="text-sm text-gray-400 mt-2">
          We'll send a 6-digit code to verify you.
        </p>
      </div>

      <div class="relative">
        <span
          class="absolute left-6 top-1/2 -translate-y-1/2 font-bold text-gray-400"
          >+91</span
        >
        <input
          type="tel"
          [(ngModel)]="phoneNumber"
          placeholder="00000 00000"
          maxlength="10"
          class="w-full pl-16 pr-6 py-4 bg-gray-50 border-none rounded-2xl text-lg font-bold tracking-widest focus:ring-2 focus:ring-orange-500/20 placeholder:font-medium placeholder:tracking-normal placeholder:text-gray-300"
        />
      </div>

      <button
        (click)="sendOtp()"
        [disabled]="phoneNumber.length < 10 || loading()"
        class="w-full py-4 bg-orange-600 text-white rounded-2xl font-black uppercase tracking-widest hover:bg-orange-700 disabled:bg-gray-100 disabled:text-gray-400 transition-all flex items-center justify-center gap-3"
      >
        <fa-icon
          *ngIf="loading()"
          [icon]="icons.spinner"
          [animation]="'spin'"
        ></fa-icon>
        <span>{{ loading() ? "Sending..." : "Get OTP" }}</span>
      </button>
      <p class="text-[10px] text-center text-gray-400 px-4 leading-relaxed">
        This site is protected by reCAPTCHA and the Google
        <a
          href="https://policies.google.com/privacy"
          target="_blank"
          class="text-orange-500 hover:underline"
          >Privacy Policy</a
        >
        and
        <a
          href="https://policies.google.com/terms"
          target="_blank"
          class="text-orange-500 hover:underline"
          >Terms of Service</a
        >
        apply.
      </p>
    </div>

    <div *ngIf="step() === 'otp'" class="space-y-6">
      <div class="text-center pt-4">
        <h3 class="text-2xl font-black text-gray-900">Verify Code</h3>
        <p class="text-sm text-gray-400 mt-2">Sent to +91 {{ phoneNumber }}</p>
      </div>

      <input
        type="text"
        [(ngModel)]="otpValue"
        placeholder="······"
        maxlength="6"
        class="w-full px-6 py-4 bg-gray-50 border-none rounded-2xl text-center text-3xl font-black tracking-[1rem] focus:ring-2 focus:ring-orange-500/20 placeholder:text-gray-200"
      />

      <button
        (click)="verifyOtp()"
        [disabled]="otpValue.length < 6 || loading()"
        class="w-full py-4 bg-gray-900 text-white rounded-2xl font-black uppercase tracking-widest hover:bg-black disabled:bg-gray-100 disabled:text-gray-400 transition-all flex items-center justify-center gap-3"
      >
        <fa-icon
          *ngIf="loading()"
          [icon]="icons.spinner"
          [animation]="'spin'"
        ></fa-icon>
        <span>Verify & Continue</span>
      </button>

      <div class="flex flex-col gap-4 items-center">
        <button
          *ngIf="countdown() === 0"
          (click)="resendOtp()"
          class="text-xs font-bold text-orange-600 uppercase tracking-widest hover:underline"
        >
          Resend Code
        </button>
        <p
          *ngIf="countdown() > 0"
          class="text-xs font-bold text-gray-400 uppercase tracking-widest"
        >
          Resend code in
          <span class="text-orange-500">0:{{ countdown() }}</span>
        </p>

        <button
          (click)="step.set('phone')"
          class="text-[10px] font-bold text-gray-400 uppercase tracking-widest hover:text-gray-600"
        >
          Change Phone Number
        </button>
      </div>
    </div>

    <div id="recaptcha-container" style="display: none"></div>
  </div>
</div>
