<div class="min-h-[100dvh] pb-24">
  <div class="sticky top-0 z-50 bg-[#F9FAFB] border-b border-gray-100">
    <div
      class="max-w-2xl mx-auto px-4 py-4 flex items-center justify-center relative"
    >
      <button
        (click)="location.back()"
        class="absolute left-4 w-10 h-10 flex items-center justify-center bg-white border border-gray-100 rounded-xl text-gray-400 hover:text-orange-600 hover:border-orange-100 transition-all shadow-sm active:scale-90 group"
      >
        <fa-icon
          [icon]="icons.back"
          class="transition-transform group-hover:-translate-x-1"
        ></fa-icon>
      </button>

      <div class="text-center">
        <h1
          class="text-lg font-black text-gray-900 tracking-tight leading-none"
        >
          My Orders
        </h1>
        <p
          class="text-[9px] text-orange-600 font-black uppercase tracking-[0.2em] mt-1"
        >
          Your Culinary History
        </p>
      </div>
      <button
        (click)="refreshOrders()"
        [disabled]="loading()"
        class="absolute right-4 w-10 h-10 flex items-center justify-center bg-white border border-gray-100 rounded-xl text-gray-400 hover:text-orange-600 hover:border-orange-100 transition-all shadow-sm active:scale-90 disabled:opacity-50"
      >
        <fa-icon
          [icon]="icons.refresh"
          [class.animate-spin]="loading()"
        ></fa-icon>
      </button>
    </div>
  </div>

  <div class="max-w-2xl mx-auto p-4 space-y-4">
    <div *ngIf="loading()" class="space-y-4">
      <div
        *ngFor="let i of [1, 2, 3]"
        class="h-44 bg-white rounded-[2rem] border border-gray-100 animate-pulse"
      ></div>
    </div>

    <div
      *ngIf="error()"
      class="bg-red-50 p-4 rounded-2xl text-red-600 text-sm font-bold flex items-center gap-3"
    >
      <fa-icon [icon]="icons.outOfStock"></fa-icon>
      {{ error() }}
    </div>

    <ng-container *ngIf="!loading() && !error()">
      <div *ngIf="groupedOrders().length; else emptyOrders" class="space-y-8">
        <div *ngFor="let group of groupedOrders()" class="space-y-4">
          <div class="flex items-center gap-4 px-2">
            <span
              class="text-[11px] font-black uppercase tracking-[0.2em] text-gray-400 whitespace-nowrap"
            >
              {{ group.label }}
            </span>
            <div class="h-[1px] w-full bg-gray-100"></div>
          </div>

          <div
            *ngFor="let order of group.orders"
            class="group bg-white rounded-[2.5rem] border border-gray-100 overflow-hidden shadow-sm hover:shadow-xl hover:shadow-orange-900/5 transition-all duration-300"
          >
            <div class="p-6">
              <div class="flex justify-between items-start mb-6">
                <div>
                  <p
                    class="text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1"
                  >
                    ID #{{ order.id }}
                  </p>
                  <p class="text-xs text-gray-900 font-black">
                    {{ order.createdAt | date: "shortTime" }}
                  </p>
                </div>
                <span
                  [class]="
                    'px-4 py-1.5 rounded-xl text-[10px] font-black uppercase tracking-wider ' +
                    getStatusClass(order.status)
                  "
                >
                  {{ order.status }}
                </span>
              </div>

              <div class="space-y-3 mb-6 bg-gray-50/50 p-4 rounded-2xl">
                <div
                  *ngFor="let item of order.orderItems"
                  class="flex justify-between text-xs"
                >
                  <span class="text-gray-600 font-bold">
                    <span class="text-orange-600">{{ item.quantity }} ×</span>
                    {{ item.itemName }}
                  </span>
                  <span class="text-gray-900 font-black"
                    >₹{{ item.price * item.quantity }}</span
                  >
                </div>
              </div>

              <div class="flex justify-between items-end">
                <div>
                  <p
                    class="text-[9px] font-black text-gray-400 uppercase tracking-widest mb-1"
                  >
                    Total Paid
                  </p>
                  <p class="text-2xl font-black text-gray-900">
                    ₹{{ order.totalAmount }}
                  </p>
                </div>
                <div class="flex gap-2">
                  <button
                    *ngIf="order.status === 'PENDING'"
                    (click)="onSendToWhatsApp(order)"
                    class="h-11 px-4 bg-[#25D366] text-white rounded-2xl flex items-center gap-2 shadow-lg shadow-green-100 active:scale-95 transition-all"
                  >
                    <fa-icon
                      [icon]="icons.whatsapp"
                      class="text-base"
                    ></fa-icon>
                    <span
                      class="text-[10px] font-black uppercase tracking-wider"
                      >Confirm</span
                    >
                  </button>
                  <button
                    class="h-11 px-4 bg-gray-900 text-white rounded-2xl flex items-center gap-2 shadow-lg shadow-gray-200 active:scale-95 transition-all"
                  >
                    <fa-icon [icon]="icons.info" class="text-base"></fa-icon>
                    <span
                      class="text-[10px] font-black uppercase tracking-wider"
                      >Details</span
                    >
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <ng-template #emptyOrders>
        <div
          class="flex flex-col items-center justify-center py-20 text-center px-4"
        >
          <div
            class="w-20 h-20 bg-orange-100 text-orange-600 rounded-[2rem] flex items-center justify-center mb-6 rotate-12"
          >
            <fa-icon [icon]="icons.history" class="text-3xl"></fa-icon>
          </div>
          <h3 class="text-2xl font-black text-gray-900">No Feast Yet!</h3>
          <p class="text-gray-500 text-sm mt-2 mb-8 max-w-[260px]">
            You haven't placed any orders. Let's find something delicious for
            you.
          </p>
          <a
            routerLink="/"
            class="inline-flex items-center gap-3 px-8 py-4 bg-orange-600 text-white rounded-2xl text-[10px] font-black uppercase tracking-[0.2em] shadow-xl shadow-orange-200 active:scale-95 transition-all"
          >
            Browse Menu
          </a>
        </div>
      </ng-template>
    </ng-container>
  </div>
</div>
